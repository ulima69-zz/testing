
%include '/dados/infor/suporte/FuncoesInfor.sas';

libname SAA_UNV '/dados/infor/conexao/2018/000000098';
libname SAA '/dados/infor/conexao/2018/000000136';
libname N_BASE '/dados/infor/conexao/2018';


/*98*/
/*OUTUBRO*/


PROC SQL;
CREATE TABLE WORK.SAA_UNV_OUT AS SELECT
IND,
COMP,
UOR,
PREFDEP,
CTRA,
OM10,
RM10
FROM SAA_UNV.indicador_000000098
WHERE COMP = 0 AND CTRA = 0
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;


PROC STDIZE DATA=WORK.SAA_UNV_OUT OUT=WORK.SAA_UNV_OUT REPONLY MISSING=0;
	VAR _NUMERIC_;
QUIT;


/*136*/
/*OUTUBRO*/


PROC SQL;
CREATE TABLE WORK.SAA_OUT AS SELECT
IND,
COMP,
UOR,
PREFDEP,
CTRA,
OM10,
RM10
FROM SAA.indicador_000000136
WHERE COMP = 0 AND CTRA = 0
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;


PROC STDIZE DATA=WORK.SAA_OUT OUT=WORK.SAA_UNV_OUT REPONLY MISSING=0;
	VAR _NUMERIC_;
QUIT;



/*CALCULO*/


/*98*/
/*NOVEMBRO*/


PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV AS SELECT
t1.PREFIXO AS PREFDEP,
t1.IND,
0 AS COMP,
t1.UOR,
t1.CTRA,
t1.MMAAAA
FROM N_BASE.acordo_ind_prf_ctra_peso t1
WHERE t1.MMAAAA = 112018 AND t1.IND = 98
GROUP BY PREFIXO
ORDER BY PREFIXO;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV_2 AS SELECT
t1.PREFDEP,
t1.IND,
t1.COMP,
t1.UOR,
t1.CTRA,
t2.OM10,
t2.RM10*1.1 AS VLR,
t1.MMAAAA
FROM WORK.SAA_UNV_NOV t1
LEFT JOIN WORK.SAA_UNV_OUT t2 ON (t1.PREFDEP = t2.PREFDEP)
WHERE t1.CTRA = 0
GROUP BY t1.PREFDEP
ORDER BY t1.PREFDEP;
QUIT;



PROC STDIZE DATA=WORK.SAA_UNV_NOV_2 OUT=WORK.SAA_UNV_NOV_2 REPONLY MISSING=0;
	VAR _NUMERIC_;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV_3 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
OM10,
IFN(VLR < 800, 800, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_UNV_NOV_2
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV_4 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR < OM10, OM10, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_UNV_NOV_3
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV_5 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR > 1000, 1000, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_UNV_NOV_4
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_UNV_NOV_6 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR >= 800 AND VLR < 810, 800, 
IFN(VLR >= 810 AND VLR < 820, 810,
IFN(VLR >= 820 AND VLR < 830, 820,
IFN(VLR >= 830 AND VLR < 840, 830,
IFN(VLR >= 840 AND VLR < 850, 840,
IFN(VLR >= 850 AND VLR < 860, 850,
IFN(VLR >= 860 AND VLR < 870, 860,
IFN(VLR >= 870 AND VLR < 880, 870,
IFN(VLR >= 880 AND VLR < 890, 880,
IFN(VLR >= 890 AND VLR < 900, 890,
IFN(VLR >= 900 AND VLR < 910, 900,
IFN(VLR >= 910 AND VLR < 920, 910,
IFN(VLR >= 920 AND VLR < 930, 920,
IFN(VLR >= 930 AND VLR < 940, 930,
IFN(VLR >= 940 AND VLR < 950, 940,
IFN(VLR >= 950 AND VLR < 960, 950,
IFN(VLR >= 960 AND VLR < 970, 960,
IFN(VLR >= 970 AND VLR < 980, 970,
IFN(VLR >= 980 AND VLR < 990, 980,
IFN(VLR >= 990 AND VLR < 1000, 990,
IFN(VLR = 1000, 1000, 0))))))))))))))))))))) AS VLR,
MMAAAA
FROM WORK.SAA_UNV_NOV_5
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;


/*98*/
/*DEZEMBRO*/


PROC SQL;
CREATE TABLE WORK_SAA_UNV_DEZ AS SELECT
PREFIXO AS PREFDEP,
IND,
0 AS COMP,
UOR,
CTRA,
1000 AS VLR,
MMAAAA
FROM BASE.acordo_ind_prf_ctra_peso
WHERE MMAAAA = 122018 AND IND = 98
GROUP BY PREFIXO
ORDER BY PREFIXO;
QUIT;


/*136*/
/*NOVEMBRO*/


PROC SQL;
CREATE TABLE WORK.SAA_NOV AS SELECT
t1.PREFIXO AS PREFDEP,
t1.IND,
0 AS COMP,
t1.UOR,
t1.CTRA,
t1.MMAAAA
FROM N_BASE.acordo_ind_prf_ctra_peso t1
WHERE t1.MMAAAA = 112018 AND t1.IND = 136
GROUP BY PREFIXO
ORDER BY PREFIXO;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_NOV_2 AS SELECT
t1.PREFDEP,
t1.IND,
t1.COMP,
t1.UOR,
t1.CTRA,
t2.OM10,
t2.RM10*1.1 AS VLR,
t1.MMAAAA
FROM WORK.SAA_NOV t1
LEFT JOIN WORK.SAA_OUT t2 ON (t1.PREFDEP = t2.PREFDEP and t1.ctra = t1.ctra)
GROUP BY t1.PREFDEP
ORDER BY t1.PREFDEP;
QUIT;



PROC STDIZE DATA=WORK.SAA_NOV_2 OUT=WORK.SAA_NOV_2 REPONLY MISSING=0;
	VAR _NUMERIC_;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_NOV_3 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
OM10,
IFN(VLR < 800, 800, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_NOV_2
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_NOV_4 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR < OM10, OM10, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_NOV_3
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_NOV_5 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR > 1000, 1000, VLR) AS VLR,
MMAAAA
FROM WORK.SAA_NOV_4
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;



PROC SQL;
CREATE TABLE WORK.SAA_NOV_6 AS SELECT
PREFDEP,
IND,
COMP,
UOR,
CTRA,
IFN(VLR >= 800 AND VLR < 810, 800, 
IFN(VLR >= 810 AND VLR < 820, 810,
IFN(VLR >= 820 AND VLR < 830, 820,
IFN(VLR >= 830 AND VLR < 840, 830,
IFN(VLR >= 840 AND VLR < 850, 840,
IFN(VLR >= 850 AND VLR < 860, 850,
IFN(VLR >= 860 AND VLR < 870, 860,
IFN(VLR >= 870 AND VLR < 880, 870,
IFN(VLR >= 880 AND VLR < 890, 880,
IFN(VLR >= 890 AND VLR < 900, 890,
IFN(VLR >= 900 AND VLR < 910, 900,
IFN(VLR >= 910 AND VLR < 920, 910,
IFN(VLR >= 920 AND VLR < 930, 920,
IFN(VLR >= 930 AND VLR < 940, 930,
IFN(VLR >= 940 AND VLR < 950, 940,
IFN(VLR >= 950 AND VLR < 960, 950,
IFN(VLR >= 960 AND VLR < 970, 960,
IFN(VLR >= 970 AND VLR < 980, 970,
IFN(VLR >= 980 AND VLR < 990, 980,
IFN(VLR >= 990 AND VLR < 1000, 990,
IFN(VLR = 1000, 1000, 0))))))))))))))))))))) AS VLR,
MMAAAA
FROM WORK.SAA_NOV_5
GROUP BY PREFDEP
ORDER BY PREFDEP;
QUIT;


/*136*/
/*DEZEMBRO*/


PROC SQL;
CREATE TABLE WORK_SAA_DEZ AS SELECT
PREFIXO AS PREFDEP,
IND,
0 AS COMP,
UOR,
CTRA,
1000 AS VLR,
MMAAAA
FROM BASE.acordo_ind_prf_ctra_peso
WHERE MMAAAA = 122018 AND IND = 136
GROUP BY PREFIXO
ORDER BY PREFIXO;
QUIT;



DATA TEBELA_FINAL_98;
	MERGE WORK.SAA_UNV_NOV_6 WORK_SAA_UNV_DEZ;
	BY PREFDEP MMAAAA;
RUN;



DATA TEBELA_FINAL_136;
	MERGE WORK.SAA_NOV_6 WORK_SAA_DEZ;
	BY PREFDEP MMAAAA;
RUN;



x cd /dados/infor/conexao/2018/000000098;
x cd /dados/infor/conexao/2018/000000136;
x chmod 2777 *;






